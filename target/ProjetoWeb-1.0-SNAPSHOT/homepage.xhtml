<?xml version="1.0" encoding="UTF-8"?>
<!--
Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
Click nbfs://nbhost/SystemFileSystem/Templates/JSP_Servlet/XHtml.xhtml to edit this template
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>HomePage</title>
    </h:head>
    <h:body style="background-color: #000d16">
        <h:form id="form">
            <p:growl id="msgs" showDetail="true"/>
            <div id="toolbar" style="display: flex">
                <p:toolbar style="width: 100%">
                    <p:toolbarGroup style="gap: 10px">
                        <p:commandButton update="@form" action="#{managerVenda.homePage()}" icon="pi pi-home"
                                         styleClass="mr-2" />
                    </p:toolbarGroup>
                    <p:toolbarGroup align="right" style="gap: 10px">


                        <p:menuButton buttonStyle="border-radius: 50%" icon="pi pi-user">
                            <p:menuitem value="Perfil" url="http://localhost:8080/ProjetoWeb/profile.xhtml"/>
                            <p:menuitem value="Sair"/>
                        </p:menuButton>

                        <p:menuButton buttonStyle="border-radius: 50%" icon="pi pi-users">
                            <p:menuitem value="Pesquisar Cliente" oncomplete="PF('pesquisa-dialog').show()" icon="pi pi-users" styleClass="mr-2"/>
                            <p:menuitem value="Cadastrar Cliente" oncomplete="PF('cadastrar-cliente-dialog').show()"
                                        actionListener="#{managerPaciente.novoPaciente()}" process="@this"
                                        update=":form:msgs :form:cadastrar-cliente-dialog" 
                                        immediate="true" icon="pi pi-user-plus" styleClass="mr-2"/>
                        </p:menuButton>

                    </p:toolbarGroup>
                </p:toolbar>
            </div>

            <p:dialog id="pesquisa-dialog" style="border-radius: 25px" header="Pesquisar Cliente" showEffect="fade" modal="true"
                      widgetVar="pesquisa-dialog" responsive="true">
                <p:outputPanel id="pesquisa-content" class="ui-fluid">
                    <div class="field">
                        <p:outputLabel rendered="#{managerPaciente.trocarFormulario}">Digite o CPF do cliente: </p:outputLabel>
                        <p:inputMask value="#{managerPaciente.paciente.cpf}" mask="999.999.999-99"/>
                    </div>
                </p:outputPanel>
                <f:facet name="footer" >
                    <div id="campos" style="display: flex; gap: 10px">
                        <p:commandButton value="Pesquisar" id="btPesquisar" style="color: white; size: 30px" icon="pi pi-search"
                                         styleClass="ui-button-success" process="@this form:pesquisa-content" update=":form:cadastrar-cliente-dialog"
                                         oncomplete="PF('cadastrar-cliente-dialog').show()"
                                         actionListener="#{managerPaciente.pesquisarPaciente()}"/>
                    </div>
                </f:facet>
            </p:dialog>

            <p:dialog id="cadastrar-cliente-dialog" style="border-radius: 25px" header="Cadastrar Paciente" showEffect="fade" modal="true"
                      widgetVar="cadastrar-cliente-dialog" responsive="true" onHide="#{managerPaciente.novoPaciente()}">
                <p:outputPanel id="cliente-content" class="ui-fluid">
                    <p:outputPanel>
                        <div class="field">
                            <p:outputLabel value="Nome" />
                            <p:inputText value="#{managerPaciente.paciente.nome}"/>

                            <p:outputLabel value="CPF"/>
                            <p:inputMask value="#{managerPaciente.paciente.cpf}" mask="999.999.999-99"/>

                            <p:outputLabel value="Telefone" />
                            <p:inputMask value="#{managerPaciente.paciente.telefone}" mask="(99)9 9999-9999" />

                            <p:outputLabel value="Sexo"/>
                            <p:selectOneMenu value="#{managerPaciente.paciente.sexo}" >
                                <f:selectItem itemLabel="Homem" itemValue="Homem" />
                                <f:selectItem itemLabel="Mulher" itemValue="Mulher" />
                                <f:selectItem itemLabel="Outro" itemValue="Outro" />
                            </p:selectOneMenu>
                        </div>
                    </p:outputPanel>
                </p:outputPanel>
                <f:facet id="facet" name="footer">
                    <div id="campos" style="display: flex; gap: 10px">
                        <p:commandButton value="Salvar" id="btSalvar"  style="color: white; size: 30px" icon="pi pi-plus-circle"
                                         styleClass="ui-button-success" process="@this :form:cliente-content"
                                         update=":form:msgs :form:pesquisa-dialog :form:cliente-content" 
                                         actionListener="#{managerPaciente.salvarPaciente()}" oncomplete="PF('cadastrar-cliente-dialog').hide()"/>

                        <p:commandButton value="Cancelar" style="color: white; size: 30px" icon="pi pi-times"
                                         styleClass="ui-button-success" process="@this" update=":form:pesquisa-dialog" actionListener="#{managerPaciente.cancelar()}"
                                         oncomplete="PF('cadastrar-cliente-dialog').hide()">
                        </p:commandButton>
                    </div>
                </f:facet>
            </p:dialog>

            <div id="dataTable" style="display: flex; margin-top: 15px">
                <p:dataTable style="width: 100%" rowKey="#{produto.id}" id="productTable" value="#{managerProduto.produtos}" var="produto" editable="true"
                             paginator="true" rows="5" paginatorPosition="both" paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                             rowsPerPageTemplate="5,10,{ShowAll|'All'}">

                    <p:ajax event="rowEdit" listener="#{managerProduto.onRowEdit}" update=":form:msgs"/>
                    <p:ajax event="rowEditCancel" listener="#{managerProduto.onRowCancel}" update=":form:msgs"/>

                    <p:column headerText="Nome">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{produto.nome}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText id="modelInputNome" value="#{produto.nome}" style="width: 100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Lote">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{produto.lote}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText id="modelInputLote" value="#{produto.lote}" style="width: 100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Quantidade">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{produto.quantidade}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText id="modelInputQuantidade" value="#{produto.quantidade}" style="width: 100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Preço">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{produto.preco}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText id="modelInputPreco" value="#{produto.preco}" style="width: 100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column headerText="Validade">
                        <p:cellEditor>
                            <f:facet name="output">
                                <h:outputText value="#{produto.validade}"/>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputText id="modelInputValidade" value="#{produto.validade}" style="width: 100%"/>
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column width="2%">
                        <p:rowEditor editTitle="Editar Produto" cancelTitle="Cancelar Edição" saveTitle="Salvar Edição"/>
                    </p:column>

                    <p:column width="2%">
                        <p:commandButton id="salvarProduto" icon="pi pi-save" title="View" actionListener="#{managerProduto.editarProduto(produto)}" process="@this" update="productTable"
                                         disabled="#{!managerProduto.editado}">
                            <f:setPropertyActionListener value="#{produto}" target="#{managerProduto.produtoSelecionado}"/>
                        </p:commandButton>
                    </p:column>

                    <p:column width="6%">
                        <p:commandButton icon="pi pi-trash" styleClass="ui-button-danger"
                                         oncomplete="PF('deleteProductDialog').show()">
                            <f:setPropertyActionListener value="#{produto}" target="#{managerProduto.produtoSelecionado}"/>
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
                <p:card id="card" style="width: 300px; margin-left: 15px">
                    <div style="display: flex; flex-direction: column">
                        <div style="width: 100%">
                            <p:commandButton style="width: 100%" value="Abrir Venda" update="@form" icon="pi pi-file"
                                             action="#{managerProduto.abrirVenda()}" />
                        </div>
                        <div style="margin-top: 5px">
                            <p:commandButton style="width: 100%" value="Novo Produto" oncomplete="PF('manageProductDialog').show()"
                                             icon="pi pi-plus-circle" styleClass="ui-button-success"
                                             actionListener="#{managerProduto.novoProduto()}">
                                <p:ajax update=":formsecundario:manageProductDialog" resetValues="true" />
                            </p:commandButton>
                        </div>
                        <div style="margin-top: 5px">
                            <p:commandButton style="width: 100%" value="Historico de Venda" icon="pi pi-replay"
                                             styleClass="mr-2" action="#{managerHistorico.historico()}" />
                        </div>
                    </div>
                </p:card>
            </div>

            <p:dialog id="deleteProductDialog" style="border-radius: 25px" header="Excluir Produto" showEffect="fade" modal="true"
                      widgetVar="deleteProductDialog" responsive="true">
                <p:outputPanel id="delete-content" class="ui-fluid">
                    <p:outputPanel>
                        <div class="field">
                            <p:outputLabel>Deseja deletar esse produto?</p:outputLabel>
                        </div>
                    </p:outputPanel>
                </p:outputPanel>

                <f:facet name="footer">
                    <div style="display: flex; gap: 10px">
                        <p:commandButton id="confirmaDelet" value="Excluir" process="delete-content @this" update="delete-content" icon="pi pi-check"
                                         styleClass="rounded-button ui-button-danger ui-button-flat" actionListener="#{managerProduto.deletarProduto()}"
                                         oncomplete="PF('deleteProductDialog').hide()"/>
                        <p:commandButton style="color: gray; size: 30px" id="cancelaDelet" value="Cancelar" process="@this" update="productTable" icon="pi pi-times"
                                         styleClass="rounded-button ui-button-flat"
                                         oncomplete="PF('deleteProductDialog').hide()"/>
                    </div>
                </f:facet>
            </p:dialog>

        </h:form>

        <h:form id="formsecundario">
            <div>
                <p:dialog id="manageProductDialog" style="border-radius: 25px" header="Cadastrar Novo Produto" showEffect="fade" modal="true"
                          widgetVar="manageProductDialog" responsive="true">
                    <p:outputPanel id="manage-product-content" class="ui-fluid">
                        <p:outputPanel >
                            <div class="field">
                                <p:outputLabel for="name">Nome</p:outputLabel>
                                <p:inputText style="border-radius: 10px" id="name" value="#{managerProduto.produto.nome}"  required="true" />
                            </div>

                            <div class="field">
                                <p:outputLabel for="description">Descrição</p:outputLabel>
                                <p:inputTextarea id="description" value="#{managerProduto.produto.descricao}" required="true"  />
                            </div>

                            <div class="formgrid grid">
                                <div class="field col">
                                    <p:outputLabel for="lote">Lote</p:outputLabel>
                                    <p:inputText id="lote" value="#{managerProduto.produto.lote}" required="true"/>
                                </div>

                                <div class="field col">
                                    <p:outputLabel for="price">Preço</p:outputLabel>
                                    <p:inputNumber minValue="1" id="price" value="#{managerProduto.produto.preco}"  symbol=" R$"
                                                   symbolPosition="s" decimalSeparator="," thousandSeparator="." />
                                </div>

                                <div class="field col">
                                    <p:outputLabel for="quantity">Quantidade</p:outputLabel>
                                    <p:spinner id="quantity" value="#{managerProduto.produto.quantidade}" min="0"  />
                                </div>

                                <div class="field col">
                                    <p:outputLabel for="expiration">Validade</p:outputLabel>
                                    <p:datePicker id="expiration" value="#{managerProduto.produto.validade}" />
                                </div>
                            </div>
                        </p:outputPanel>
                    </p:outputPanel>

                    <f:facet name="footer">
                        <p:commandButton value="Salvar" icon="pi pi-check" actionListener="#{managerProduto.salvarProduto()}"
                                         update=":form:productTable" process="manage-product-content @this"
                                         oncomplete="PF('manageProductDialog').hide()" >
                        </p:commandButton>
                        <p:commandButton value="Cancelar" icon="pi pi-times" onclick="PF('manageProductDialog').hide()"
                                         class="ui-button-secondary" type="button" />
                    </f:facet>
                </p:dialog>
            </div>
        </h:form>
    </h:body>
</html>
